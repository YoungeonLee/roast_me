<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Game Room</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="app"></div>
    <script type="text/babel">
        class Players extends React.Component{
            render(){
                return(
                    <div>
                    <div> {this.props.name} </div>
                    <div> {this.props.state} </div>
                    <div> {this.props.score} </div>
                    </div>
                );
            }
        }
        class App extends React.Component{
            /*
            constructor(props){
                super(props);
                this.state = {
                    loading: true
                };
            }*/
            render(){
                const items = []
                for (player in this.props.players){
                    items.push(<Players name = {player.name} score = {player.score} state = {player.state}/>)
                }
                return(
                    {items}
                );
            }

            update = () => {
                this.setState(state => ({
                    loading: false
                }))
            }
        }
 
        // websocket comp
        const roomName = "{{room_name}}";

        const gameSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/game/'
            + roomName
            + '/'
        );

        gameSocket.onmessage = function(e) {
            console.log(e)
            const data = JSON.parse(e.data);
            console.log(data)
            console.log(data.message)
            ReactDOM.render(<App players={data.players}/>, document.getElementById("app"));        };

        gameSocket.onclose = function(e) {
            alert('Websocket closed unexpectedly');
        };

        document.querySelector('#send').onclick = function(e) {
            gameSocket.send(JSON.stringify({
                'message': "message"
            }));
        };
    </script>
</body>
</html>